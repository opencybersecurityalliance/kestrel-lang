# https://schema.ocsf.io/1.1.0/objects/file
file:
    accessed_time: file.accessed
    attributes: file.attributes
    created_time: file.created
    # This "hashes" notation comes from jmespath (filter projection)
    # It's much easier to use the ECS notation in this case
    hashes[?algorithm_id == 1]:
        value: hash.md5
    hashes[?algorithm_id == 2]:
        value: hash.sha1
    hashes[?algorithm_id == 3]:
        value: hash.sha256
    hashes[?algorithm_id == 4]:
        value: hash.sha512
    hashes[?algorithm_id == 5]:
        value: hash.ssdeep
    hashes[?algorithm_id == 6]:
        value: hash.tlsh
    hashes[*]:
        value:
          - hash.md5
          - hash.sha1
          - hash.sha256
          - hash.sha512
          - hash.ssdeep
          - hash.tlsh
    modified_time: file.ctime
    mime_type: file.mime_type
    mode: file.mode
    modified_time: file.mtime
    name: file.name
    owner: file.owner
    parent_folder: file.directory
    path: file.path
    size: file.size
    type: file.type
    xattributes:
        primary_group: file.gid
        link_name: file.target_path


# https://schema.ocsf.io/1.1.0/objects/group
group:
    domain: group.domain
    name: group.name
    uid: group.id


# https://schema.ocsf.io/1.1.0/objects/process
process:
    cmd_line: process.command_line
    name: process.name
    pid: process.pid
    uid: process.entity_id
    file:
        name:
            native_field: process.executable
            native_op: LIKE
            native_value: endswith
            ocsf_value: basename
        path: process.executable
        parent_folder:
            native_field: process.executable
            native_op: LIKE
            native_value: startswith
            ocsf_value: dirname
        # This "hashes" notation comes from jmespath (filter projection)
        # It's much easier to use the ECS notation in this case
        hashes[?algorithm_id == 1]:
            value: process.hash.md5
        hashes[?algorithm_id == 2]:
            value: process.hash.sha1
        hashes[?algorithm_id == 3]:
            value: process.hash.sha256
        hashes[?algorithm_id == 4]:
            value: process.hash.sha512
        hashes[?algorithm_id == 5]:
            value: process.hash.ssdeep
        hashes[?algorithm_id == 6]:
            value: process.hash.tlsh
        hashes[*]:
            value:
              - process.hash.md5
              - process.hash.sha1
              - process.hash.sha256
              - process.hash.sha512
              - process.hash.ssdeep
              - process.hash.tlsh
    parent_process:
        cmd_line: process.parent.command_line
        name: process.parent.name
        pid: process.parent.pid
        uid: process.parent.entity_id
        file:
            name:
                native_field: process.parent.executable
                native_op: LIKE
                native_value: endswith
                ocsf_value: basename
            path: process.parent.executable
            parent_folder:
                native_field: process.parent.executable
                native_op: LIKE
                native_value: startswith
                ocsf_value: dirname


# src_endpoint: see https://schema.ocsf.io/1.1.0/objects/endpoint
src_endpoint: &src_ref
    domain:
        - client.domain
        - source.domain
    hostname:
        - client.domain
        - source.domain
    ip:
        - client.ip
        - source.ip
    mac:
        - client.mac
        - source.mac
    port:
        - client.port
        - source.port


# endpoint: see https://schema.ocsf.io/1.1.0/objects/endpoint
endpoint:
    domain:
        - client.domain
        - source.domain
        - server.domain
        - destination.domain
    hostname:
        - client.domain
        - source.domain
        - server.domain
        - destination.domain
    ip:
        - client.ip
        - source.ip
        - server.ip
        - destination.ip
    mac:
        - client.mac
        - source.mac
        - server.mac
        - destination.mac
    port:
        - client.port
        - source.port
        - server.port
        - destination.port


# dst_endpoint: see https://schema.ocsf.io/1.1.0/objects/endpoint
dst_endpoint: &dst_ref
    domain:
        - server.domain
        - destination.domain
    hostname:
        - server.domain
        - destination.domain
    ip:
        - server.ip
        - destination.ip
    mac:
        - server.mac
        - destination.mac
    port:
        - server.port
        - destination.port


# https://schema.ocsf.io/1.1.0/objects/network_traffic
# should be `network_traffic`?
traffic: &traffic
    bytes: network.bytes
    bytes_in:
        - destination.bytes
        - server.bytes
    bytes_out:
        - client.bytes
        - source.bytes
    packets: network.packets
    packets_in:
        - destination.packets
        - server.packets
    packets_out:
        - client.packets
        - source.packets


# https://schema.ocsf.io/1.1.0/objects/network_connection_info
connection_info:
    direction: network.direction  #TODO: need transformer?
    protocol_num: network.iana_number
    protocol_name: network.transport
    protocol_ver: network.type
    protocol_ver_id:
        native_field: network.type
        native_value: ip_version_to_network_layer
        ocsf_value: network_layer_to_ip_version


# https://schema.ocsf.io/1.1.0/objects/certificate
certificate:
    expiration_time: x509.not_after
    created_time: x509.not_before
    serial_number: x509.serial_number
    fingerprints[*]:
        algorithm: x509.signature_algorithm
    version: x509.version_number
    issuer: x509.issuer.distinguished_name
    subject: x509.subject.distinguished_name
    #uid:


# https://schema.ocsf.io/1.1.0/objects/user
user:
    full_name: user-account:display_name
    name: user-account:account_login
    type: user-account:account_type
    uid: user-account:user_id


# https://schema.ocsf.io/1.1.0/classes/network_activity
# Network Activity [4001] Class
network_activity:
    src_endpoint: *src_ref
    dst_endpoint: *dst_ref
    traffic: *traffic
